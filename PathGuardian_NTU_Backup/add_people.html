<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>PathGuardian - Add People</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <script src="js/shared-data.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { "primary": "#3670e2", "danger": "#ef4444", "warning": "#f59e0b", "success": "#10b981" },
                    fontFamily: { "display": ["Lexend", "sans-serif"] },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Lexend', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .slide-in {
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col font-display">

    <!-- Header -->
    <header class="bg-white px-6 pt-10 pb-4 shadow-sm border-b border-slate-100 z-10">
        <h1 class="text-3xl font-bold text-slate-900 mb-2">People</h1>
        <p class="text-slate-500 mb-4">Manage people you are caring for.</p>

        <div class="flex gap-2">
            <button onclick="sortPeople('name')" id="sort-name"
                class="px-4 py-2 bg-slate-100 rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-200 transition-colors">Name</button>
            <button onclick="sortPeople('status')" id="sort-status"
                class="px-4 py-2 bg-slate-100 rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-200 transition-colors">Status</button>
            <button onclick="sortPeople('recent')" id="sort-recent"
                class="px-4 py-2 bg-slate-900 text-white rounded-lg text-xs font-bold shadow-md transition-colors">Recent</button>
        </div>
    </header>

    <main class="flex-grow px-6 py-6 pb-32 space-y-8">

        <!-- Add New Section -->
        <section class="bg-white rounded-3xl p-6 shadow-sm border-2 border-dashed border-slate-200">
            <h2 class="font-bold text-lg mb-4 flex items-center gap-2">
                <span class="material-icons-round text-primary text-2xl">person_add</span>
                Add Person
            </h2>
            <div class="space-y-4">
                <input type="text" id="new-name" placeholder="Full Name"
                    class="w-full bg-slate-50 border-transparent rounded-xl px-4 py-3 font-semibold focus:border-primary focus:ring-0">
                <select id="new-rel"
                    class="w-full bg-slate-50 border-transparent rounded-xl px-4 py-3 font-semibold text-slate-600 focus:border-primary focus:ring-0">
                    <option>Parent</option>
                    <option>Grandparent</option>
                    <option>Child</option>
                    <option>Friend</option>
                </select>
                <button onclick="addNewPerson()"
                    class="w-full bg-primary text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-primary/30 active:scale-95 transition-transform flex items-center justify-center gap-2">
                    <span class="material-icons-round">add</span> Add to Circle
                </button>
            </div>
        </section>

        <!-- People List -->
        <div id="people-list" class="space-y-4">
            <!-- Filled via JS -->
        </div>

    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav
        class="fixed bottom-0 left-0 right-0 z-30 bg-white/90 backdrop-blur-md border-t border-slate-200 pb-6 pt-3 px-6 flex justify-between items-center shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
        <a href="caretaker_dashboard.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">map</span>
            <span class="text-[10px] font-medium">Map</span>
        </a>
        <a href="caretaker_alerts.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">notifications</span>
            <span class="text-[10px] font-medium">Alerts</span>
        </a>
        <a href="add_people.html"
            class="w-14 h-14 bg-primary text-white rounded-full flex items-center justify-center -mt-8 border-4 border-slate-50 shadow-xl active:scale-95 transition-transform">
            <span class="material-icons-round text-3xl">add</span>
        </a>
        <a href="caretaker_history.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">history</span>
            <span class="text-[10px] font-medium">History</span>
        </a>
        <a href="caretaker_settings.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">settings</span>
            <span class="text-[10px] font-medium">Settings</span>
        </a>
    </nav>

    <script>
        let sortBy = 'recent';

        function renderList() {
            const container = document.getElementById('people-list');
            let people = window.SharedData.getPeople();

            // Sort
            if (sortBy === 'name') {
                people.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortBy === 'status') {
                // Warning/Danger first
                const score = { 'danger': 2, 'warning': 1, 'safe': 0 };
                people.sort((a, b) => score[b.status] - score[a.status]);
            } else {
                // Recent
                people.sort((a, b) => new Date(b.lastActive) - new Date(a.lastActive));
            }

            container.innerHTML = '';
            people.forEach(p => {
                const statusColor = p.status === 'danger' ? 'text-red-500' : (p.status === 'warning' ? 'text-amber-500' : 'text-green-500');
                const statusIcon = p.status === 'safe' ? 'verified' : 'warning';

                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center gap-4 slide-in";
                card.innerHTML = `
                    <div class="relative">
                        <img src="${p.photoUrl}" class="w-14 h-14 rounded-full object-cover bg-slate-100">
                        <div class="absolute -bottom-1 -right-1 bg-white rounded-full p-1">
                            <span class="material-icons-round ${statusColor} text-sm">${statusIcon}</span>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-lg text-slate-800">${p.name}</h3>
                        <p class="text-xs text-slate-500 font-bold">${p.relationship}</p>
                    </div>
                    <button onclick="window.location.href='caretaker_dashboard.html'" class="w-10 h-10 rounded-xl bg-slate-50 text-primary flex items-center justify-center active:bg-slate-100">
                        <span class="material-icons-round">chevron_right</span>
                    </button>
                    ${people.length > 1 ? `<button onclick="remove('${p.id}')" class="w-10 h-10 rounded-xl bg-red-50 text-red-500 flex items-center justify-center active:bg-red-100"><span class="material-icons-round">delete</span></button>` : ''}
                `;
                container.appendChild(card);
            });
        }

        function addNewPerson() {
            const name = document.getElementById('new-name').value.trim();
            const rel = document.getElementById('new-rel').value;
            if (!name) return;

            window.SharedData.addPerson({
                name,
                relationship: rel,
                location: { lat: 1.3521, lng: 103.8198, name: 'Unknown Location' }
            });

            document.getElementById('new-name').value = '';
            renderList();
        }

        function remove(id) {
            if (confirm('Remove this person?')) {
                window.SharedData.removePerson(id);
                renderList();
            }
        }

        function sortPeople(type) {
            sortBy = type;
            // Update buttons
            ['name', 'status', 'recent'].forEach(t => {
                const btn = document.getElementById('sort-' + t);
                if (t === type) {
                    btn.className = "px-4 py-2 bg-slate-900 text-white rounded-lg text-xs font-bold shadow-md transition-colors";
                } else {
                    btn.className = "px-4 py-2 bg-slate-100 rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-200 transition-colors";
                }
            });
            renderList();
        }

        renderList();
    </script>
</body>

</html>