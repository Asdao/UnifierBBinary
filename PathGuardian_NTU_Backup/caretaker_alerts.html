<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>PathGuardian - Alerts</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <script src="js/shared-data.js"></script>
    <script src="js/alert-system.js"></script>
    <script src="js/demo-manager.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { "primary": "#3670e2", "danger": "#ef4444", "warning": "#f59e0b", "success": "#10b981" },
                    fontFamily: { "display": ["Lexend", "sans-serif"] },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Lexend', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col font-display">

    <header class="bg-white sticky top-0 z-10 px-6 pt-12 pb-4 shadow-sm border-b border-slate-100 mb-4">
        <h1 class="text-3xl font-bold text-slate-900 mb-4">Alerts</h1>
        <div class="flex gap-2">
            <button onclick="filterAlerts('all')" id="btn-all"
                class="flex-1 bg-slate-900 text-white py-2 rounded-full text-sm font-bold transition-colors">All</button>
            <button onclick="filterAlerts('active')" id="btn-active"
                class="flex-1 bg-slate-100 text-slate-500 py-2 rounded-full text-sm font-bold transition-colors">Active</button>
            <button onclick="filterAlerts('resolved')" id="btn-resolved"
                class="flex-1 bg-slate-100 text-slate-500 py-2 rounded-full text-sm font-bold transition-colors">Resolved</button>
        </div>
    </header>

    <main class="flex-1 px-4 pb-32 space-y-4" id="alerts-container">
        <!-- Filled via JS -->
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav
        class="fixed bottom-0 left-0 right-0 z-30 bg-white/90 backdrop-blur-md border-t border-slate-200 pb-6 pt-3 px-6 flex justify-between items-center shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
        <a href="caretaker_dashboard.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">map</span>
            <span class="text-[10px] font-medium">Map</span>
        </a>
        <a href="caretaker_alerts.html" class="flex flex-col items-center gap-1 text-primary">
            <span class="material-icons-round text-2xl">notifications</span>
            <span class="text-[10px] font-bold">Alerts</span>
        </a>
        <a href="add_people.html"
            class="w-14 h-14 bg-primary text-white rounded-full flex items-center justify-center -mt-8 border-4 border-slate-50 shadow-xl active:scale-95 transition-transform">
            <span class="material-icons-round text-3xl">add</span>
        </a>
        <a href="caretaker_history.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">history</span>
            <span class="text-[10px] font-medium">History</span>
        </a>
        <a href="caretaker_settings.html" class="flex flex-col items-center gap-1 text-slate-400">
            <span class="material-icons-round text-2xl">settings</span>
            <span class="text-[10px] font-medium">Settings</span>
        </a>
    </nav>

    <script>
        let currentFilter = 'all';

        function renderAlerts() {
            const container = document.getElementById('alerts-container');
            const alerts = window.AlertSystem.getAlerts();
            const people = window.SharedData.getPeople();

            // Filter
            const filtered = alerts.filter(a => {
                if (currentFilter === 'all') return true;
                return a.status === currentFilter;
            });

            container.innerHTML = '';

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-20 opacity-50">
                        <span class="material-icons-round text-6xl text-slate-300 mb-4">notifications_off</span>
                        <p class="font-bold text-lg">No alerts found</p>
                    </div>
                `;
                return;
            }

            filtered.forEach(alert => {
                const person = people.find(p => p.id === alert.personId) || { name: 'Unknown', photoUrl: '' };
                const isResolved = alert.status === 'resolved';

                const card = document.createElement('div');
                card.className = `bg-white rounded-2xl p-5 shadow-sm border ${isResolved ? 'border-slate-100 opacity-70' : 'border-slate-100'} relative overflow-hidden`;

                // Priority Strip
                if (!isResolved && alert.priority === 'critical') {
                    card.classList.add('ring-2', 'ring-red-100');
                    card.innerHTML += `<div class="absolute left-0 top-0 bottom-0 w-1.5 bg-red-500"></div>`;
                } else if (!isResolved && alert.priority === 'medium') {
                    card.innerHTML += `<div class="absolute left-0 top-0 bottom-0 w-1.5 bg-amber-500"></div>`;
                }

                const iconColor = isResolved ? 'text-green-500 bg-green-50' : (alert.color === 'red' ? 'text-red-500 bg-red-50' : 'text-amber-500 bg-amber-50');

                card.innerHTML += `
                    <div class="flex items-start gap-4 pl-2">
                        <img src="${person.photoUrl}" class="w-12 h-12 rounded-full object-cover bg-slate-100">
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-slate-900">${alert.title}</h3>
                                <span class="text-xs font-bold text-slate-400">${window.SharedData.timeAgo(alert.timestamp)}</span>
                            </div>
                            <p class="text-sm text-slate-500 mb-2">${alert.locationName}</p>
                            
                            <div class="flex items-center gap-2 mb-3">
                                <div class="px-2 py-1 rounded-lg ${iconColor} flex items-center gap-1 text-xs font-bold uppercase">
                                    <span class="material-icons-round text-sm">${alert.icon}</span>
                                    ${isResolved ? 'Resolved' : 'Active'}
                                </div>
                                <span class="text-xs text-slate-400 font-medium">for ${person.name}</span>
                            </div>

                            ${!isResolved ? `
                                <div class="flex gap-2 mt-3">
                                    <button onclick="resolve('${alert.id}')" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 py-2.5 rounded-xl text-sm font-bold transition-colors">
                                        Mark Done
                                    </button>
                                    <button onclick="window.location.href='caretaker_dashboard.html'" class="flex-1 bg-primary text-white py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-primary/20 hover:bg-primary-dark transition-colors">
                                        View Map
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterAlerts(type) {
            currentFilter = type;
            document.querySelectorAll('header button').forEach(b => {
                b.className = 'flex-1 bg-slate-100 text-slate-500 py-2 rounded-full text-sm font-bold transition-colors';
            });
            document.getElementById('btn-' + type).className = 'flex-1 bg-slate-900 text-white py-2 rounded-full text-sm font-bold transition-colors shadow-lg';
            renderAlerts();
        }

        function resolve(id) {
            window.AlertSystem.resolveAlert(id);
            renderAlerts();
        }

        renderAlerts();
        // Polling
        setInterval(renderAlerts, 5000);

    </script>
</body>

</html>